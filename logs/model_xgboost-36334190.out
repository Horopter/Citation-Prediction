Activating virtual environment: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/Kaggle_2/venv
==========================================
JOB STARTUP INFORMATION
==========================================
Host:        gl1001.arc-ts.umich.edu
Date:        2025-11-19T08:32:49-05:00
SLURM_JOBID: 36334190
Working directory: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/Kaggle_2
Python:      /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/Kaggle_2/venv/bin/python
==========================================
Verifying Python environment...
‚úì Basic packages available
‚úì Python environment verified
Installing Jupyter kernel: model_xgboost-36334190...
Installed kernelspec model_xgboost-36334190 in /home/santoshd/.local/share/jupyter/kernels/model_xgboost-36334190
‚úì Kernel installed successfully
Running pre-flight validation...
‚úì Found model-ready files
‚úì Notebook found: src/notebooks/model_xgboost_all_features.ipynb
‚úÖ Pre-flight validation passed!
=== Cleaning Previous Runs ===
‚úì Cleanup completed
Running papermill -> /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/Kaggle_2/runs/model_xgboost_executed_20251119-083318.ipynb
Notebook: src/notebooks/model_xgboost_all_features.ipynb
Kernel: model_xgboost-36334190
Input Notebook:  src/notebooks/model_xgboost_all_features.ipynb
Output Notebook: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/Kaggle_2/runs/model_xgboost_executed_20251119-083318.ipynb
Executing notebook with kernel: model_xgboost-36334190
Executing Cell 1---------------------------------------
Ending Cell 1------------------------------------------
Executing Cell 2---------------------------------------
Ending Cell 2------------------------------------------
Executing Cell 3---------------------------------------
Ending Cell 3------------------------------------------
Executing Cell 4---------------------------------------
Ending Cell 4------------------------------------------
Executing Cell 5---------------------------------------

================================================================================
MODEL_XGBOOST EXECUTION STARTED
Start Time: 2025-11-19 08:33:56
================================================================================


Using device: cuda

Ending Cell 5------------------------------------------
Executing Cell 6---------------------------------------
PROJECT_ROOT: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/Kaggle_2
MODEL_READY_DIR: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/Kaggle_2/data/model_ready

Ending Cell 6------------------------------------------
Executing Cell 7---------------------------------------
‚úÖ Using sklearn IncrementalPCA (memory-efficient)

Ending Cell 7------------------------------------------
Executing Cell 8---------------------------------------
Ending Cell 8------------------------------------------
Executing Cell 9---------------------------------------
‚úÖ Memory utilities imported from shared module
üíæ Memory: 0.62 GB (RAM) | 0.00/0.00 GB (GPU used/reserved)

Ending Cell 9------------------------------------------
Executing Cell 10--------------------------------------
‚úÖ Enhanced robustness utilities loaded
‚úÖ Training robustness wrappers loaded

Ending Cell 10-----------------------------------------
Executing Cell 11--------------------------------------
Ending Cell 11-----------------------------------------
Executing Cell 12--------------------------------------

================================================================================
PHASE 1: Data Loading
================================================================================
Loading train from /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/Kaggle_2/data/model_ready/train_model_ready.parquet

Loading val from /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/Kaggle_2/data/model_ready/val_model_ready.parquet


üìä Data Summary:
  Regular features: 54
  Embedding sent_transformer_: 384 dims
  Embedding scibert_: 768 dims
  Embedding specter2_: 768 dims
  Train samples: 960000, Positive: 65808, Negative: 894192
  Val samples: 120000, Positive: 8075, Negative: 111925

‚è±Ô∏è  Data Loading Time: 56.99 seconds (0.95 minutes)

üíæ Memory: 32.77 GB (RAM) | 0.00/0.00 GB (GPU used/reserved)

Ending Cell 12-----------------------------------------
Executing Cell 13--------------------------------------
Ending Cell 13-----------------------------------------
Executing Cell 14--------------------------------------
Ending Cell 14-----------------------------------------
Executing Cell 15--------------------------------------

================================================================================
PHASE 2: PCA Preprocessing
================================================================================


üìä Applying IncrementalPCA to embedding families...
  sent_transformer_: 384 dims ‚Üí 32 components
  scibert_: 768 dims ‚Üí 32 components
  specter2_: 768 dims ‚Üí 32 components

  Fitting PCA on subset (288000/960000 samples) for sent_transformer_

  Fitting PCA on subset (288000/960000 samples) for scibert_

  Fitting PCA on subset (288000/960000 samples) for specter2_

‚úÖ Checkpoint saved: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/Kaggle_2/data/checkpoints/model_xgboost_checkpoint_pca.pkl

‚úÖ Checkpoint saved: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/Kaggle_2/data/checkpoints/model_xgboost_checkpoint_pca.pkl

üìä After IncrementalPCA:
  Train embeddings: (960000, 96)
  Val embeddings: (120000, 96)

  Combined train: (960000, 150)
  Combined val: (120000, 150)

‚è±Ô∏è  PCA Preprocessing Time: 306.77 seconds (5.11 minutes)

üíæ Memory: 34.09 GB (RAM) | 0.00/0.00 GB (GPU used/reserved)

Ending Cell 15-----------------------------------------
Executing Cell 16--------------------------------------
Ending Cell 16-----------------------------------------
Executing Cell 17--------------------------------------

================================================================================
PHASE 3: SMOTETomek Resampling
================================================================================

üìä Checking class imbalance and applying SMOTETomek resampling...
  Before: 960000 samples, Positive: 65808, Negative: 894192
  Imbalance ratio: 13.59:1
  ‚ö†Ô∏è Large dataset detected (960,000 samples), using sampling_strategy=0.2 for memory efficiency
  Fitting SMOTETomek...

  After: 1068602 samples, Positive: 176624, Negative: 891978
  Balance ratio: 5.05:1

‚è±Ô∏è  SMOTETomek Resampling Time: 1566.17 seconds (26.10 minutes)

Ending Cell 17-----------------------------------------
Executing Cell 18--------------------------------------
Ending Cell 18-----------------------------------------
Executing Cell 19--------------------------------------

================================================================================
PHASE 4: Feature Scaling
================================================================================

üìä Applying Feature Scaling to combined features...

  Fitting scaler on sample (50000 samples) for OOM protection...

  Transforming train data in chunks (size=50000)...

  Transforming val data in chunks (size=50000)...

  ‚úÖ Scaling complete!

‚è±Ô∏è  Feature Scaling Time: 7.76 seconds (0.13 minutes)
üíæ Memory: 34.84 GB (RAM) | 0.00/0.00 GB (GPU used/reserved)

Ending Cell 19-----------------------------------------
Executing Cell 20--------------------------------------
Ending Cell 20-----------------------------------------
Executing Cell 21--------------------------------------

================================================================================
PHASE 5: Hyperparameter Tuning Setup
================================================================================

‚ö†Ô∏è Dataset too large (1188602 samples), using subset (25000 samples) for CV

  Using 25000 samples for hyperparameter tuning

üìä Full dataset for CV: (25000, 150), labels: (25000,)
  Positive samples: 3885, Negative: 21115

üîç Hyperparameter tuning:
  Method: RandomizedSearchCV
  CV folds: 3
  Random iterations: 10

üíæ Memory: 34.44 GB (RAM) | 0.00/0.00 GB (GPU used/reserved)

Ending Cell 21-----------------------------------------
Executing Cell 22--------------------------------------

================================================================================
PHASE 5B: Hyperparameter Tuning
================================================================================
Fitting 3 folds for each of 10 candidates, totalling 30 fits


‚úÖ Hyperparameter tuning complete (35.4 min)
  Best CV F1: 0.7620
  Best parameters:
    subsample: 0.8
    scale_pos_weight: 5.435006435006435
    reg_lambda: 1
    reg_alpha: 0.5
    num_leaves: 100
    n_estimators: 300
    min_child_samples: 20
    max_depth: 7
    learning_rate: 0.1
    colsample_bytree: 0.8

üíæ Memory: 32.15 GB (RAM) | 0.00/0.00 GB (GPU used/reserved)

Ending Cell 22-----------------------------------------
Executing Cell 23--------------------------------------

================================================================================
PLOTTING: Cross-Validation Performance Curves
================================================================================

<Figure size 1400x500 with 2 Axes>
<IPython.core.display.Image object>
‚úÖ CV curves saved to: logs/model_xgboost_cv_curves.png

Ending Cell 23-----------------------------------------
Executing Cell 24--------------------------------------
Ending Cell 24-----------------------------------------
Executing Cell 25--------------------------------------

================================================================================
PHASE 6: Final Model Training & Threshold Tuning
================================================================================
Training Final Model on Full Dataset...
  Memory cleaned before final training


‚úÖ Final Optimal Threshold: 0.6275
‚úÖ Final Validation F1: 0.5187

‚è±Ô∏è  Final Model Training & Threshold Tuning Time: 29.41 seconds (0.49 minutes)

üìä Classification Report:
              precision    recall  f1-score   support

           0     0.9712    0.9463    0.9586    111925
           1     0.4507    0.6109    0.5187      8075

    accuracy                         0.9237    120000
   macro avg     0.7110    0.7786    0.7387    120000
weighted avg     0.9362    0.9237    0.9290    120000


üíæ Memory: 32.37 GB (RAM) | 0.00/0.00 GB (GPU used/reserved)

Ending Cell 25-----------------------------------------
Executing Cell 26--------------------------------------

================================================================================
PLOTTING: Final Model Performance Visualizations
================================================================================

<Figure size 1600x1200 with 7 Axes>
<IPython.core.display.Image object>
‚úÖ Final performance plots saved to: logs/model_xgboost_final_performance.png

Ending Cell 26-----------------------------------------
Executing Cell 27--------------------------------------
Ending Cell 27-----------------------------------------
Executing Cell 28--------------------------------------

üíæ Model saved to: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/Kaggle_2/models/saved_models/model_xgboost_all_features_best.pkl

Ending Cell 28-----------------------------------------
Executing Cell 29--------------------------------------
Ending Cell 29-----------------------------------------
Executing Cell 30--------------------------------------

================================================================================
PHASE 7: Test Predictions
================================================================================
Generating Test Predictions...
Loading test from /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/Kaggle_2/data/model_ready/test_model_ready.parquet

‚úÖ Checkpoint saved: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/Kaggle_2/data/checkpoints/model_xgboost_checkpoint_pca.pkl

  Predicting in chunks (size=10000) for OOM protection...


‚úÖ Submission saved to: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/Kaggle_2/data/submission_files/submission_model_xgboost.csv
  Test predictions: 120000, Positive: 10801, Negative: 109199

‚è±Ô∏è  Test Predictions Time: 31.72 seconds (0.53 minutes)

üíæ Memory: 32.63 GB (RAM) | 0.00/0.00 GB (GPU used/reserved)

================================================================================

================================================================================
MODEL_XGBOOST EXECUTION COMPLETED
Start Time: 2025-11-19 08:33:56
End Time: 2025-11-19 09:43:24
Total Execution Time: 4167.93 seconds (69.47 minutes / 1.16 hours)
Final Validation F1 Score: 0.5187
================================================================================

End Time: 2025-11-19 09:43:24
Final Validation F1 Score: 0.5187
================================================================================


Ending Cell 30-----------------------------------------
‚úì Notebook execution completed in 4211s
Checking for output files...
‚úì Found submission file: submission_model_xgboost.csv
‚úì Found saved model: model_xgboost_all_features_best.pkl
‚úì Found execution log: model_xgboost_all_features_run.log

============================================================
EXECUTION SUMMARY
============================================================
Notebook execution time: 4211s
============================================================
Removed /home/santoshd/.local/share/jupyter/kernels/model_xgboost-36334190
